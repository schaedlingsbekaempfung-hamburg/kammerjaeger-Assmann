/**
 * off-canvas nav
 * @name ruffnav
 * @author Dominik Kressler
 * @version 2.1.1
 * @thanks Jasmin Reiff
 * @edit by Malte Zoudlik
 * @copyright (c) 2018
 */
function Ruffnav(e){var n;ruffnav={},ruffnav=J.merge({toggler:"#naviToggled",navContainer:"#pageNavi",subParent:".hasSub",subClass:".sub",backText:"back",mobileBreak:"medium",quickbar:"#quickbar",quickbarScroll:!0},e),ruffnav.breakAt=0==(n=ruffnav).mobileBreak?1e13:parseInt(breakpoint()[n.mobileBreak])*parseInt(breakpoint().default),ruffnav.open=!1,ruffnav.mode="mobile",ruffnav.listener=!1;var r=document.querySelector("html");subTogglers=document.querySelectorAll(ruffnav.navContainer+" "+ruffnav.subParent),elms={},elms.navContainer=document.querySelector(ruffnav.navContainer),elms.subs=elms.navContainer.querySelectorAll(ruffnav.subClass),elms.subParents=elms.navContainer.querySelectorAll(ruffnav.subParent),elms.nav=elms.navContainer.querySelector("nav"),elms.navContainer.setAttribute("data-depth",0),elms.quickbar=document.querySelector(ruffnav.quickbar),elms.currentSub=!1;var t=function(n){var r=[],e=n.parentNode.childNodes;return[].forEach.call(e,function(e){"#text"!==e.nodeName&&e.classList.contains("current")&&e!=n&&r.push(e)}),r},s=document.querySelectorAll(ruffnav.navContainer+" "+ruffnav.subParent+" > a");for(i=0;i<s.length;++i){s[i].classList.add("first-level");var a=document.createElement("li");a.setAttribute("class",s[i].getAttribute("class").replace("first-level","")),a.innerHTML=s[i].outerHTML;var l=s[i].getAttribute("data-category-label");""!=l&&null!=l&&(a.querySelector("a").innerHTML=l),null!=s[i].nextElementSibling&&s[i].nextElementSibling.insertBefore(a,s[i].nextElementSibling.firstChild),s[i].outerHTML=s[i].outerHTML.replace("a",'span tabindex="0" ')}for(i=0;i<elms.subs.length;++i){elms.subs[i].setAttribute("data-parent-name",elms.subs[i].previousElementSibling.innerText);var u=document.createElement("li");u.classList.add("nav-back"),u.setAttribute("tabindex","0"),u.innerHTML="<span>"+ruffnav.backText+"</span>",elms.subs[i].insertBefore(u,elms.subs[i].firstChild)}document.querySelector(ruffnav.toggler).addEventListener("change",function(e){this.checked?(ruffnav.open=!0,r.classList.add("hidden-scroll")):(ruffnav.open=!1,r.classList.remove("hidden-scroll"),d(null,!0))});var o=function(e){if("A"==e.target.nodeName)return!0;e.preventDefault(),e.stopPropagation(),elms.current="LI"!==e.target.nodeName?function(e){for(;e&&e!==document;e=e.parentNode)if("LI"===e.nodeName)return e;return null}(e.target):e.target,elms.currentParent=elms.current.parentNode;var n=elms.current.querySelector(ruffnav.subClass),r=parseInt(elms.navContainer.getAttribute("data-depth"));return 0<t(elms.current).length&&!1===elms.current.classList.contains("nav-back")?(d(t(elms.current)[0],!1),t(elms.current)[0].classList.remove("current"),elms.current.classList.add("current"),n.classList.add("current"),n.classList.add("open")):elms.current.classList.contains("nav-back")?(d(elms.currentParent,!1),elms.currentParent.classList.remove("current"),elms.currentParent.classList.remove("open"),elms.currentParent.parentNode.classList.remove("current"),r-=1):(elms.current.classList.add("current"),null!==n.classList&&n.classList.add("current"),function(){var e=elms.nav.querySelectorAll(".sub.open");for(var n in e)0==isNaN(n)&&e[n]!=elms.currentSub&&(e[n].classList.remove("open"),f(e[n],0,300))}(),n.classList.add("open"),r+=1),elms.navContainer.setAttribute("data-depth",r),document.querySelector(ruffnav.navContainer+" .current")&&!ruffnav.listener?(document.addEventListener("click",c),document.addEventListener("keydown",m),window.addEventListener("scroll",c),ruffnav.listener=!0):null===document.querySelector(ruffnav.navContainer+" .current")&&ruffnav.listener&&(document.removeEventListener("click",c),document.removeEventListener("keydown",m),window.removeEventListener("scroll",c),ruffnav.listener=!1),elms.current};function c(e){d(null,!0),document.removeEventListener("click",c),document.removeEventListener("keydown",m),window.removeEventListener("scroll",c),ruffnav.listener=!1}function m(e){27===e.keyCode&&(d(null,!0),document.removeEventListener("click",c),document.removeEventListener("keydown",m),window.removeEventListener("scroll",c),ruffnav.listener=!1)}function d(e,n){(n||void 0===e)&&(e=document),[].forEach.call(e.querySelectorAll(".current"),function(e){e.classList.remove("current"),e.classList.remove("open")})}function v(e){return document.documentElement.clientWidth+(window.innerWidth-document.documentElement.clientWidth)>=e.breakAt?e.mode="desktop":e.mode="mobile",function(){for(elms.nav.style.transform="translateX(0)",elms.navContainer.setAttribute("data-depth",0),i=0;i<elms.subs.length;++i)elms.subs[i].classList.remove("current");for(i=0;i<elms.subParents.length;++i)elms.subParents[i].classList.remove("current")}(),e}for(ruffnav=v(ruffnav),i=0;i<subTogglers.length;++i)subTogglers[i].addEventListener("click",o);function f(e,n,r){if(!(r<=0)){var t=(n-e.scrollTop)/r*10;setTimeout(function(){e.scrollTop=e.scrollTop+t,e.scrollTop!==n&&f(e,n,r-10)},10)}}return window.addEventListener("resize",function(){ruffnav=v(ruffnav)}),ruffnav.quickbarScroll&&(lastScrollTop=0,document.addEventListener("scroll",function(e){var n=window.pageYOffset||document.documentElement.scrollTop;n>lastScrollTop&&!1===ruffnav.open?elms.quickbar.classList.add("hide"):elms.quickbar.classList.remove("hide"),lastScrollTop=n<=0?0:n})),ruffnav}